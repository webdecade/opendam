var defaultBodyPaddingTop = 51;

function processToEmpty()
{
	jQuery.post(
		configPath + "selection/removeAllFrom",
		function(data) {
			jQuery("#selection-container").myWall("reload");
			displayPagination(jQuery("#selection-container").myWall("getLines"));

			var count = jQuery(".top-under .navbar-inner h4 div span").html();

			jQuery(".top-under .navbar-inner h4 div span").html("");
			hideSelectionBar(function() {
				resetSelectionBar();
			});
		},
		"json"
	);
}

function emptySelectionFile()
{
	if(jQuery(".selection-container").height() > 0)
	{
		var selector = "#selection-container .item-selection";
		var other = ".selection-thumb-container .thumbnail-selection";
	}
	else
	{
		var selector = ".selection-thumb-container .thumbnail-selection";
		var other = "#selection-container .item-selection";
	}

	jQuery(other).remove();

	jQuery(selector).fadeOut(400, function() {
		jQuery(this).remove();
	});

	processToEmpty();
}

function processToRemove(object, id)
{
	jQuery.post(
		configPath + "selection/removeFrom",
		{ id: id },
		function(data) {
			object.remove();

			jQuery("#selection-container").myWall("reload");
			displayPagination(jQuery("#selection-container").myWall("getLines"));

			var count = jQuery(".top-under .navbar-inner h4 div span").html();

			if(count == "")
				count = 0;

			var total = parseInt(count, 10) - 1;

			if(parseInt(total, 10) > 0)
				jQuery(".top-under .navbar-inner h4 div span").html(total);
			else
			{
				jQuery(".top-under .navbar-inner h4 div span").html("");
				hideSelectionBar(function() {
					resetSelectionBar();
				});
			}

			jQuery(".selection-thumb-container .thumbnail-selection.hide:first").removeClass("hide");
		},
		"json"
	);
}

function removeSelectionFile(id)
{
	if(jQuery(".selection-container").height() > 0)
		var selector = "#selection-container .item-selection[data-id=" + id + "]";
	else
		var selector = ".selection-thumb-container .thumbnail-selection[data-id=" + id + "]";

	jQuery(selector).fadeOut(400, function() {
		processToRemove(jQuery(this), id);
	});
}

function slideBody(padding, speed, callback)
{
	jQuery("body").stop().animate({
		"padding-top": padding + "px"
	}, speed, function() {
		if(callback)
			callback();
	});
}

function showSelectionBar()
{
	callback = arguments[0];

	var paddingTop = jQuery("body").css("padding-top").replace(/[^-\d\.]/g, '');
	var height = jQuery(".top-under").height();

	if(!jQuery(".top-under").is(":visible") && jQuery(".top-under").hasClass("empty"))
	{
		jQuery(".top-under").slideDown(400, function() {
			if(callback)
				callback();
		});

		if(jQuery(window).scrollTop() == 0)
			slideBody((parseInt(paddingTop, 10) + parseInt(height, 10)), 400);
		else
		{
			jQuery(window).scroll(function() {
				if(jQuery(window).scrollTop() == 0 && !jQuery(".top-under").hasClass("empty"))
					slideBody((parseInt(paddingTop, 10) + parseInt(height, 10)), 400);
			});
		}

		if(jQuery(".actions-container").hasClass("navbar-fixed-top"))
		{
			var cssTop = jQuery(".actions-container").css("top").replace(/[^-\d\.]/g, '');

			jQuery(".actions-container").stop().animate({
				"top": (parseInt(cssTop, 10) + parseInt(height, 10)) + "px"
			}, 400);
		}
	}
	else
	{
		if(callback)
			callback();
	}
}

function hideSelectionBar(callback)
{
	callback = arguments[0];

	var count = jQuery(".top-under .navbar-inner h4 div span").html();

	if(count == "")
		count = 0;

	if(parseInt(count, 10) > 0)
	{
		if(callback)
		{
			callback();
		}
	}
	else
	{
		if(jQuery(".top-under").is(":visible"))
		{
			var height = jQuery(".top-under").height();

			jQuery(".top-under").slideUp(400, function() {
				/*jQuery("body").removeClass("selection");

				if(jQuery(".selected-actions").is(":visible"))
				{
					var top = jQuery(".actions-container").css("top").replace(/[^-\d\.]/g, '');
					var paddingTop = jQuery("body").css("padding-top").replace(/[^-\d\.]/g, '');

					jQuery(".actions-container").css("top", (top - height) + "px");
					jQuery("body").css("padding-top", (paddingTop - height) + "px");
				}
				else
					jQuery("body").removeAttr("style");*/

				if(callback)
					callback();
			});

			if(jQuery(".selected-actions").is(":visible"))
			{
				var cssTop = jQuery(".actions-container").css("top").replace(/[^-\d\.]/g, '');

				jQuery(".actions-container").stop().animate({
					"top": (parseInt(cssTop, 10) - parseInt(height, 10)) + "px"
				}, 400);
			}

			slideBody(defaultBodyPaddingTop, 400, function() {
				jQuery("body").removeClass("selection");
				jQuery("body").removeAttr("style");
			});
		}
		else
		{
			if(callback)
				callback();
		}
	}
}

function displayPagination(count)
{
	var pageSelection = 1;

	if(count > pageSelection)
	{
		jQuery("#pagination-selection").pagination({
			items: count,
			itemsOnPage: 1,
			cssStyle: "pagination-ajax",
			prevText: "<i class='icon-double-angle-left'></i>",
			nextText: "<i class='icon-double-angle-right'></i>",
			firstText: "",
			lastText: "",
			edges: 0,
			onPageClick: function(pageNumber, event) {
				var gutterWidth = 8;
				sign = parseInt(pageSelection, 10) - parseInt(pageNumber, 10);

				pageSelection = pageNumber;

				var slide = jQuery("#selection-container").parent().width();
				var marginLeft = jQuery("#selection-container").attr("data-translation");

				if(!marginLeft)
					marginLeft = 0;

				jQuery(".row-" + parseInt(parseInt(pageSelection) - 1) + " img").each(function() {
					if(jQuery(this).attr("data-src"))
					{
						jQuery(this).attr("src", jQuery(this).attr("data-src"));
						jQuery(this).removeAttr("data-src");
					}
				});

				var translation = parseInt((parseInt(slide, 10) * parseInt(sign)) + parseInt(marginLeft) + (parseInt(sign) * parseInt(gutterWidth)));
				jQuery("#selection-container").css("transform", "translate(" + translation + "px, 0px)");
				jQuery("#selection-container").css("-webkit-transform", "translate(" + translation + "px, 0px)");
				jQuery("#selection-container").css("-moz-transform", "translate(" + translation + "px, 0px)");
				jQuery("#selection-container").css("-o-transform", "translate(" + translation + "px, 0px)");
				jQuery("#selection-container").css("-ms-transform", "translate(" + translation + "px, 0px)");
				jQuery("#selection-container").attr("data-translation", translation);
			}
		});
	}
}

function processToAdd(type, id)
{
	jQuery.post(
		configPath + "selection/addTo",
		{ type: type, id: id },
		function(data) {
			var count = jQuery(".top-under .navbar-inner h4 div span").html();
			var files = "<div>" + data.html + "</div>";
			var items = jQuery(files).children();

			if(count == "")
				count = 0;

			var total = parseInt(count, 10) + parseInt(data.add, 10);

			if(parseInt(total, 10) > 0)
			{
				jQuery(".top-under .navbar-inner h4 div span").html(total);

				jQuery(".top-under .navbar-inner h4 div").removeClass("empty");

				var childs = jQuery(".selection-thumb-container").children();

				jQuery(".selection-thumb-container").prepend(data.thumb);

				jQuery("#selection-container").prepend(items);
				jQuery("#selection-container").myWall("reload");
				displayPagination(jQuery("#selection-container").myWall("getLines"));
			}
			else
			{
				jQuery(".top-under").slideUp(400, function() {
					resetSelectionBar();
				});
			}
		},
		"json"
	);
}

var addFilesFlag = false;

function addFilesToBasket()
{
	var ids = new Array;

	if(!addFilesFlag)
	{
		addFilesFlag = true;

		jQuery('input[name="file_ids[]"]').each(function () {
			if(jQuery(this).is(":checked") == true)
			{
				var file_id = jQuery(this).val();
				var object = jQuery(".item-file[data-value=" + file_id + "]");

				var clone = object.clone().prependTo(object).css({"position": "absolute", "opacity": "0.4"});
				var offsetContainer = jQuery(".selection-thumb-container a").length > 0 ? jQuery(".selection-thumb-container a").last().offset() : jQuery(".selection-thumb-container").offset();
				var offsetClone = clone.offset();
				var offsetTop = 0;
				var heightTop = 0;

				jQuery(".navbar-fixed-top").each(function() {
					if(jQuery(this).is(":visible"))
					{
						if(jQuery(this).offset().top > offsetTop)
							offsetTop = jQuery(this).offset().top;

						heightTop += jQuery(this).height();
					}
				});

				jQuery(clone).animate({
					left: (offsetContainer.left - offsetClone.left),
					top: Math.round(((object.offset().top - offsetTop) + clone.height() - heightTop) * -1)
				}, 1200, function() {
					jQuery(clone).remove();

					jQuery(".top-under").removeClass("empty");
				});

				ids.push(file_id);
			}
		});

		showSelectionBar();

		addFilesFlag = false;

		processToAdd("files", ids);
	}
}

function addToBasket(type, id)
{
	switch(type)
	{
		case "folder": var object = jQuery(".item-folder[data-value=" + id + "]"); break;
		case "group": var object = jQuery(".item-group[data-value=" + id + "]"); break;
		case "file":
			var object = jQuery(".item-file[data-value=" + id + "]");

			if(!object.find(".actions.basket").hasClass("added"))
				object.find(".actions.basket").addClass("added");

			if(object.length <= 0)
				object = jQuery(".file-div");
		break;
	}

	if(!object.data("clicked"))
	{
		object.data("clicked", true);

		var offsetObject = object.offset();
		var clone = object.clone().prependTo(object).css({"position": "fixed", "top": (object.offset().top - jQuery(window).scrollTop()) + "px", "opacity": "0.4"});
		var offsetContainer = jQuery(".selection-thumb-container a").length > 0 ? jQuery(".selection-thumb-container").last().offset() : jQuery(".selection-thumb-container").offset();

		showSelectionBar(function() {
			jQuery(clone).animate({
				position: "fixed",
				left: (offsetContainer.left > 0 ? offsetContainer.left : jQuery(window).width() / 2),
				top: clone.height() * -1
			}, 800, function() {
				jQuery(clone).remove();

				jQuery(".top-under").removeClass("empty");

				object.data("clicked", false);

				processToAdd(type, id);
			});
		});
	}
}

function addToBasketLite(object_id, type)
{
	var display = jQuery('#content-cart').css('display');

	jQuery.post(
		configPath + "selection/addTo",
		{ object_id: object_id, type: type },
		function(data) {
			jQuery("#span-cart").fadeOut("400", function() {
				jQuery("#span-cart").html(data.html);
				if(display == "none")
					jQuery('#content-cart').slideDown();
				else
					jQuery('#content-cart').css('display', display);

				jQuery("#my-cart").addClass("hover");
				jQuery("#span-cart").fadeIn();
			});
		},
		"json"
	);
}

function removeFromBasket(file_id)
{
	var display = jQuery(window.parent.document).find('#content-cart').css('display');

	jQuery.post(
		configPath + "selection/removeFrom",
		{ file_id: file_id },
		function(data) {
			jQuery("#content-show-cart").fadeOut("400", function() {
				jQuery("#content-show-cart").html(data.htmlShow);
				jQuery("#content-show-cart").fadeIn();
			});

			jQuery(window.parent.document).find("#span-cart").fadeOut("400", function() {
				jQuery(window.parent.document).find("#span-cart").html(data.html);
				jQuery(window.parent.document).find('#content-cart').css('display', display);
				jQuery(window.parent.document).find("#my-cart").addClass("hover");
				jQuery(window.parent.document).find("#span-cart").fadeIn();
			});
		},
		"json"
	);
}

function removeAllFromBasket()
{
	var display = jQuery(window.parent.document).find('#content-cart').css('display');

	jQuery.post(
		configPath + "selection/removeAllFrom",
		{ },
		function(data) {
			jQuery("#content-show-cart").fadeOut("400", function() {
				jQuery("#content-show-cart").html(data.htmlShow);
				jQuery("#content-show-cart").fadeIn();
			});

			jQuery(window.parent.document).find("#span-cart").fadeOut("400", function() {
				jQuery(window.parent.document).find("#span-cart").html(data.html);
				jQuery(window.parent.document).find('#content-cart').css('display', display);
				jQuery(window.parent.document).find("#my-cart").addClass("hover");
				jQuery(window.parent.document).find("#span-cart").fadeIn();
			});
		},
		"json"
	);
}

function resetSelectionBar()
{
	jQuery(".top-under").addClass("empty");
	jQuery("#pagination-selection").html("");

	jQuery(".selection-container").removeAttr("style");
	jQuery(".selection-thumb-container").addClass("span8").removeClass("span7").removeAttr("style");

	jQuery("#selection-actions .share").removeClass("expand");
	jQuery("#selection-actions .trash").removeClass("expand");
	jQuery("#selection-actions").parent().addClass("span2").removeClass("span3");

	jQuery("#toogle-selection").find(".icon-angle-up").addClass("icon-angle-down").removeClass("icon-angle-up");
}