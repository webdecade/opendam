function resizeFacebox() {
    $(document).trigger("resize.facebox")
}

function inArrayFacebox(array, a) {
    var b = array.length;
    for (var c = 0; c < b; c++) {
        var d = new RegExp(array[c], "g");
        if (d.test(a)) {
            return true
        }
    }
    return false
}

function closeFacebox() {
    $(document).trigger("close.facebox")
}(function (h) {
    var g = 950;
    var j = 0;
    var d = 0;
    h.facebox = function (q, p) {
        h.facebox.loading();
        if (q.ajax) {
            i(q.ajax, p)
        } else {
            if (q.image) {
                c(q.image, p)
            } else {
                if (q.div) {
                    n(q.div, p)
                } else {
                    if (q.iframe) {
                        k(q.iframe, p)
                    } else {
                        if (h.isFunction(q)) {
                            q.call(h)
                        } else {
                            h.facebox.reveal(q, p)
                        }
                    }
                }
            }
        }
    };
    h.extend(h.facebox, {
        settings: {
            minHeight: 600,
            opacity: 0.25,
            overlay: true,
            loadingImage: "/images/icons/loader/big-circle.gif",
            closeImage: "/images/icons/delete-hover.png",
            imageTypes: ["png", "jpg", "jpeg", "gif"],
            faceboxHtml: '			<div id="facebox" style="display:none;"> 			  <div class="popup"> 				<table> 				  <tbody> 					<tr> 					  <td class="tr"/><td class="b"/><td class="tr"/> 					</tr> 					<tr> 					  <td class="b"/> 					  <td class="body" valign="top" > 						<div class="content"> 						</div> 						<a href="#" class="close" style="position: absolute; right:24px; opacity: 1; top: 8px; visibility:hidden;"><div></div></a> 					  </td> 					  <td class="b"/> 					</tr> 					<tr> 					  <td class="bl"/><td class="b"/><td class="br"/> 					</tr> 				  </tbody> 				</table> 			  </div> 			</div>'
        },
        loading: function () {
            o();
            if (h("#facebox .loading").length == 1) {
                return true
            }
            f();
            h(document).bind("beforeReveal.facebox", function () {
                h("select").hide()
            });
            h(document).bind("close.facebox", function () {
                h("select").show()
            });
            h("#facebox .content").empty();
            h("#facebox .close").css({
                visibility: "hidden"
            });
            h("#facebox .body").children().hide().end().append('<div class="loading" style="padding: 8px;"><img src="' + h.facebox.settings.loadingImage + '"/></div>');
            var q = Math.round(h(window).height() * 0.02);
            var r = h("#facebox").width();
            if (r < g) {
                r = g
            }
            if (j > 0) {
                r = j
            }
            if (h(window).width() <= r) {
                var p = 0
            } else {
                var p = h(window).width() / 2 - 205
            }
            h("#facebox").css({
                top: q,
                left: p
            }).show();
            window.scrollTo(0, 0);
            h(document).bind("keydown.facebox", function (s) {
                if (s.keyCode == 27) {
                    h.facebox.close()
                }
                return true
            });
            h(document).trigger("loading.facebox")
        },
        updatePosition: function () {
            newleft = h(window).width() / 2 - (h("#facebox table").width() / 2);
            if (newleft < 0) {
                newleft = 0
            }
            var q = h("#facebox").width();
            if (q < g) {
                q = g
            }
            if (j > 0) {
                q = j
            }
            if (h(window).width() <= q) {
                var p = 0
            } else {
                var p = newleft
            }
            h("#facebox").css("left", p)
        },
        reveal: function (r, p) {
            h(document).trigger("beforeReveal.facebox");
            if (p) {
                h("#facebox .content").addClass(p)
            }
            h("#facebox .content").append(r);
            h("#facebox .body").children().fadeIn("normal");
            var s = h("#facebox").width();
            if (s < g) {
                s = g
            }
            if (j > 0) {
                s = j
            }
            if (h(window).width() <= s) {
                var q = 0
            } else {
                var q = h(window).width() / 2 - (h("#facebox table").width() / 2)
            }
            h("#facebox").css("left", q);
            h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")
        },
        close: function () {
            h(document).trigger("close.facebox");
            return false
        }
    });
    h.fn.facebox = function (p) {
        o(p);

        function q() {
            h.facebox.loading(true);
            var r = this.rel.match(/facebox\[?\.(\w+)\]?/);
            if (r) {
                r = r[1]
            }
            n(this.href, r);
            return false
        }
        return this.bind("click.facebox", q)
    };

    function o(r) {
        if (h.facebox.settings.inited) {
            return true
        } else {
            h.facebox.settings.inited = true
        }
        h(document).trigger("init.facebox");
        e();
        var p = h.facebox.settings.imageTypes.join("|");
        h.facebox.settings.imageTypesRegexp = new RegExp(".(" + p + ")$", "i");
        if (r) {
            h.extend(h.facebox.settings, r)
        }
        h("body").append(h.facebox.settings.faceboxHtml);
        var q = [new Image(), new Image()];
        q[0].src = h.facebox.settings.closeImage;
        q[1].src = h.facebox.settings.loadingImage;
        h("#facebox").find(".b:first, .bl, .br, .tl, .tr").each(function () {
            q.push(new Image());
            q.slice(-1).src = h(this).css("background-image").replace(/url\((.+)\)/, "$1")
        });
        h("#facebox .close").click(h.facebox.close);
        h("#facebox .close_image").attr("src", h.facebox.settings.closeImage)
    }

    function l() {
        var q, p;
        if (self.pageYOffset) {
            p = self.pageYOffset;
            q = self.pageXOffset
        } else {
            if (document.documentElement && document.documentElement.scrollTop) {
                p = document.documentElement.scrollTop;
                q = document.documentElement.scrollLeft
            } else {
                if (document.body) {
                    p = document.body.scrollTop;
                    q = document.body.scrollLeft
                }
            }
        }
        return new Array(q, p)
    }

    function m() {
        var p;
        if (self.innerHeight) {
            p = self.innerHeight
        } else {
            if (document.documentElement && document.documentElement.clientHeight) {
                p = document.documentElement.clientHeight
            } else {
                if (document.body) {
                    p = document.body.clientHeight
                }
            }
        }
        return p
    }

    function e() {
        var p = h.facebox.settings;
        p.loadingImage = p.loading_image || p.loadingImage;
        p.closeImage = p.close_image || p.closeImage;
        p.imageTypes = p.image_types || p.imageTypes;
        p.faceboxHtml = p.facebox_html || p.faceboxHtml
    }

    function n(q, p) {
        if (q.match(/#/)) {
            var r = window.location.href.split("#")[0];
            var s = q.replace(r, "");
            h.facebox.reveal(h(s).show().replaceWith("<div id='facebox_moved'></div>"), p)
        } else {
            if (q.match(h.facebox.settings.imageTypesRegexp)) {
                c(q, p)
            } else {
                i(q, p)
            }
        }
    }

    function c(q, p) {
        var r = new Image();
        r.onload = function () {
            h("#facebox .loading").remove();
            h.facebox.reveal('<div class="image"><img src="' + r.src + '" /></div>', p);
            h("#facebox .close").css({
                visibility: "visible"
            })
        };
        r.src = q
    }

    function i(q, p) {
        h.get(q, function (r) {
            h("#facebox .loading").remove();
            h.facebox.reveal(r, p);
            h("#facebox .close").css({
                visibility: "visible"
            })
        })
    }

    function k(r, q) {
        var t = false;
        for (var s = 0; s < facebox_sizes.length; s++) {
            var p = facebox_sizes[s].pages;
            var u = facebox_sizes[s].id;
            if (inArrayFacebox(p, r)) {
                t = true;
                j = u;
                d = 1
            }
        }
        if (t == false) {
            j = 0;
            d = 0
        }
        h.facebox.reveal('<iframe id="facebox_iframe" name="facebox_iframe" scrolling="no" frameBorder="0" border="0" src="" style="display:none;"></iframe>', q);
        h("#facebox_iframe").attr("src", r).load(function () {
            h("#facebox .loading").remove();
            h(document).trigger("resize.facebox")
        })
    }

    function b() {
        return h.facebox.settings.overlay == false || h.facebox.settings.opacity === null
    }

    function f() {
        if (b()) {
            return
        }
        if (h("#facebox_overlay").length == 0) {
            h("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')
        }
        h("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity", h.facebox.settings.opacity).fadeIn(200);
        return false
    }

    function a() {
        if (b()) {
            return
        }
        h("#facebox_overlay").fadeOut(200, function () {
            h("#facebox_overlay").removeClass("facebox_overlayBG");
            h("#facebox_overlay").addClass("facebox_hide");
            h("#facebox_overlay").remove()
        });
        return false
    }
    h(document).bind("close.facebox", function () {
        h(document).unbind("keydown.facebox");
        h("#facebox").fadeOut(function () {
            if (h("#facebox_moved").length == 0) {
                h("#facebox .content").removeClass().addClass("content")
            } else {
                h("#facebox_moved").replaceWith(h("#facebox .content").children().hide())
            }
            a();
            h("#facebox .loading").remove()
        })
    });
    h(document).bind("resize.facebox", function () {
        h("#facebox .close").css({
            visibility: "visible"
        });
        var y = h("#facebox_iframe");
        var t = h("#facebox").width();
        var w = Math.round(h(window).height() * 0.96);
        var p = h.browser;
        var q = h("#facebox_iframe").contents().attr("URL");
        if (t < g) {
            t = g
        }
        var x = false;
        for (var v = 0; v < facebox_sizes.length; v++) {
            var s = facebox_sizes[v].pages;
            var r = facebox_sizes[v].id;
            if (inArrayFacebox(s, q)) {
            	var reg = new RegExp("group/manageUsers", "g");
                if (reg.test(q)) {
                	h("#facebox_iframe").css("overflow", "auto");
                }

                x = true;
                j = r;
                d = 1
            }
        }
        if (x == false) {
            j = 0;
            d = 0
        }
        if (j > 0) {
            t = j;
            h("#facebox").css({
                width: t + "px"
            })
        } else {
            h("#facebox").css({
                width: ""
            });
            var t = h("#facebox").width()
        }
        y.css("width", t + "px");
        y.fadeIn(200);
        if (w < h.facebox.settings.minHeight) {
            w = (h.facebox.settings.minHeight + 5)
        }
        if (d > 0) {
            w = (h("#facebox_iframe").contents().find("body").height() + 50)
        }
        if (h(window).width() <= t) {
            var u = 0
        } else {
            var u = h(window).width() / 2 - (h("#facebox table").width() / 2)
        }
        h("#facebox").css({
            left: u
        });
        h("#facebox_iframe").animate({
            height: w + "px",
            width: t + "px"
        }, 500, "linear", function () {
            if (h("#facebox_iframe").contents().find(".subMenuBarTitle").length > 0) {
                h("#facebox_iframe").contents().find("#searchResults-popup .inner").css("max-height", (w - 236) + "px")
            } else {
                h("#facebox_iframe").contents().find("#searchResults-popup .inner").css("max-height", (w - 148) + "px")
            }
            h("#facebox_iframe").contents().find("#map").css("height", (w - 135) + "px");
            if (h("#facebox_iframe").contents().find("#breadCrumb").length > 0) {
                var A = 0;
                h("#facebox_iframe").contents().find("#breadCrumb").children().each(function () {
                    A += h(this).width() + 12;
                });
                if (A > 670) {
                    h("#facebox_iframe").contents().find("#breadCrumb").children().each(function () {
                        if (!h(this).hasClass("home")) {
                            h(this).html(h(this).html().substring(0, 4) + "..." + h(this).html().substring((h(this).html().length - 4)))
                        }
                    })
                }
            }
            if (p.msie && p.version.slice(0, 3) == "6.0") {
                h("#facebox_iframe").contents().find("#searchResults-popup .inner").css("width", (t - 19) + "px");
                if (h("#facebox_iframe").contents().find(".subMenuBarTitle").length > 0) {
                    h("#facebox_iframe").contents().find("#searchResults-popup .inner").css("height", (w - 198) + "px")
                } else {
                    h("#facebox_iframe").contents().find("#searchResults-popup .inner").css("height", (w - 135) + "px")
                }
            }
            if (p.msie && p.version.slice(0, 3) == "8.0") {
                if (h(window).width() <= t) {
                    var z = 0
                } else {
                    var z = h(window).width() / 2 - (h("#facebox table").width() / 2)
                }
                h("#facebox").css({
                    left: z
                })
            }
        })
    })
})(jQuery);